<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
Budgets
-->
	
	<record id="budget_instance_form" model="ir.ui.view">
         <field name="name">consolidated.instance.form</field>
        <field name="model">consolidated.instance</field>
        <field name="inherit_id" ref="syd_consolidated_base.view_consolidated_instance_form"/>
        
            <field name="arch" type="xml">
               <xpath expr="//button[@name='test_connection']"
                    position="after">
                    <button name="get_and_update_models"  type="object" string="Update Models"/>
                    
                </xpath>
            </field>
        </record>  
	
	 <record id="view_consolidated_budget_contaner_model_tree" model="ir.ui.view">
        <field name="name">consolidated.budget.lines.container_model.tree</field>
        <field name="model">consolidated.budget.lines.container_model</field>
        <field name="arch" type="xml">
            <tree string="Budgetary Container Model" editable="bottom">
            	<field name="name" />
            	<field name="share"/>
            </tree>
        </field>
    </record>
    
    <record id="open_budget_container_model_form" model="ir.actions.act_window">
        <field name="name">Budgetary Container Model</field>
        <field name="res_model">consolidated.budget.lines.container_model</field>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="view_consolidated_budget_contaner_model_tree"/>
    </record>    
        
	<record id="view_consolidated_budget_container_search" model="ir.ui.view">
        <field name="name">consolidated.budget.lines.container.search</field>
        <field name="model">consolidated.budget.lines.container</field>
        <field name="arch" type="xml">
            <search string="Budget Container">
                <field name="name" filter_domain="[('name','ilike',self)]" string="Budgetary Position"/>
            </search>
        </field>
    </record>

    <record id="view_consolidated_budget_contaner_tree" model="ir.ui.view">
        <field name="name">consolidated.budget.lines.container.tree</field>
        <field name="model">consolidated.budget.lines.container</field>
        <field name="arch" type="xml">
            <tree string="Budgetary Container" editable="bottom">
            	<field name="sequence" widget="handle" />
            	<field name="model_id"/>
                <field name="parent_id"/>
                <field name="name"/>
                
                <field name="consolidated_budget_rule_id" />
                <field name="sum"/>
            </tree>
        </field>
    </record>
    
    <record id="view_consolidated_budget_container_form" model="ir.ui.view">
        <field name="name">consolidated.budget.lines.container.form</field>
        <field name="model">consolidated.budget.lines.container</field>
        <field name="arch" type="xml">
            <form string="Budgetary Container">
            <sheet>
	            	<group>
		                <field name="parent_id"/>
		                
		                <field name="name"/>
		                <field name="consolidated_budget_rule_id" attrs="{'invisible':[('parent_id','=',False)]}"/>
		                
	               </group> 
	               
	               
	               
               </sheet>
            </form>
        </field>
    </record>

    <record id="open_budget_container_form" model="ir.actions.act_window">
        <field name="name">Budgetary Container</field>
        <field name="res_model">consolidated.budget.lines.container</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="view_consolidated_budget_contaner_tree"/>
        <field name="search_view_id" ref="view_consolidated_budget_container_search"/>
    </record>
  
    
  
    <record id="view_consolidated_budget_rule_search" model="ir.ui.view">
        <field name="name">consolidated.budget.rule.search</field>
        <field name="model">consolidated.budget.rule</field>
        <field name="arch" type="xml">
            <search string="Budget Rule">
                <field name="name" filter_domain="[('name','ilike',self)]" string="Budgetary Position"/>
            </search>
        </field>
    </record>

    <record id="view_consolidated_budget_rule_post_tree" model="ir.ui.view">
        <field name="name">consolidated.budget.rule.tree</field>
        <field name="model">consolidated.budget.rule</field>
        <field name="arch" type="xml">
            <tree string="Budgetary Rule">
                <field name="name"/>
                <field name="model_name"/>
                
            </tree>
        </field>
    </record>
    
    <record id="view_consolidated_budget_rule_post_form" model="ir.ui.view">
        <field name="name">consolidated.budget.rule.form</field>
        <field name="model">consolidated.budget.rule</field>
        <field name="arch" type="xml">
            <form string="Budgetary Rule">
            <sheet>
	            	<group>
	            		
		                <field name="name"/>
		                <field name="model_name"/>
		                <field name="expected" attrs="{'invisible':[('model_name','!=','crm.lead')]}"/>
	               </group> 
	               <notebook >
		               <page string="General Accounts" attrs="{'invisible':[('model_name','in',('sale.order.line','crm.lead'))]}">
		               		<field name="account_ids"/>
		               	</page>
		               	<page string="Customer/Vendor" >
		               		<field name="partner_ids"  />
		               	</page>
		               <page string="Analytic Accounts" attrs="{'invisible':[('model_name','in',('crm.lead'))]}">
		               		<field name="analytic_ids"  />
		               	</page>
		               	<page string="Analytic Groups" attrs="{'invisible':[('model_name','!=','account.analytic.line')]}">
		               		<field name="group_ids"  />
		               </page>
		               <page string="Products">
		               		<field name="product_ids"/>
		               	</page>
		               	<page string="Custom Filter">
		               		<field name="filter_domain" widget="domain" options="{'model': 'model_name', 'in_dialog': True}"/>
		               	</page>
	               	</notebook>
	               
	               
               </sheet>
            </form>
        </field>
    </record>

    <record id="open_budget_rule_form" model="ir.actions.act_window">
        <field name="name">Budgetary Rule</field>
        <field name="res_model">consolidated.budget.rule</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="view_consolidated_budget_rule_post_tree"/>
        <field name="search_view_id" ref="view_consolidated_budget_rule_search"/>
    </record>
  
   
  
              
              
              


   

    <record model="ir.ui.view" id="consolidated_budget_view_form">
        <field name="name">consolidated.budget.view.form</field>
        <field name="model">consolidated.budget</field>
        <field name="arch" type="xml">
            <form string="Budget">
                <header>
                    <button string="Confirm" name="action_budget_confirm" states="draft" type="object"
                            class="oe_highlight"/>
                    <button string="Send" name="action_budget_validate" states="confirm,sent-planned" type="object"
                            class="oe_highlight"/>
                    <button string="Send Planned Value" name="action_budget_validate_plan" states="confirm" type="object"
                            class="oe_highlight"/>

                    <button string="Reset to Draft" name="action_budget_draft" states="cancel" type="object"/>
                    <button string="Cancel Budget" name="action_budget_cancel" states="confirm,validate" type="object"/>
                    
                    <button string="Calculate" states="draft" name="action_calc"  type="object"
                            />
                    <button string="Populate"  name="action_populate_from_container"  type="object" attrs="{'invisible':['|',('model_id','=',False),('state','!=','draft')]}"
                            />
                    <field name="state" widget="statusbar" />
                </header>
                <sheet string="Budget">
                	
                    <div class="oe_title">
                        <label for="name" class="oe_edit_only"/>
                        <h1>
                            <field name="name" attrs="{'readonly':[('state','!=','draft')],'required':[('model_id','!=',False)]}" placeholder="Budget Name"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                        	<field name="instance_id" attrs="{'readonly':[('state','!=','draft')]}"/>
                        	<field name="model_id" attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="user_id" attrs="{'readonly':[('state','!=','draft')]}"/>
                        </group>
                        <group>
                            <label for="date_from" string="Period"/>
                            <div>
                                <field name="date_from" class="oe_inline"
                                       attrs="{'readonly':[('state','!=','draft')]}"/>
                                -
                                <field name="date_to" class="oe_inline" attrs="{'readonly':[('state','!=','draft')]}"
                                       nolabel="1"/>
                            </div>
                            <field name="company_id" groups="base.group_multi_company" attrs="{'readonly':[('state','!=','draft')]}" options="{'no_create': True}"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Lines" >
                            <field name="consolidated_budget_line"
                            		widget="section_and_note_one2many"
                                   context="{'default_date_from': date_from,'default_date_to': date_to}" colspan="4"
                                   nolabel="1" attrs="{'readonly':[('state','not in',('draft','sent-plan'))]}">
                                <tree string="Budget Lines" editable="bottom" decoration-warning="consolidated_budget_rule_id == False and display_type==False"  >
                                	    <control>
                                            <create name="add_line_control" string="Add a line"/>
                                        </control>
                                	<field name="sequence" widget="handle" />
                                    <field name="display_type" invisible="1"/>
                                    <field name="name" widget="section_and_note_text" />
                                    <field name="consolidated_budget_lines_container_id" required="1"/>
                                    <field name="consolidated_budget_rule_id" invisible="1" />
                                    <field name="date_from" required="1"/>
                                    <field name="date_to" required="1"/>
                                    
                                    <field name="currency_id" invisible="1"/>
                                    <field name="planned_amount"  />
                                    <field name="description"  />
                                    <field name="adjustment" attrs="{'readonly':[('consolidated_budget_rule_id','=',False)]}" />
                                    
                                    <field name="practical_amount"  attrs="{'readonly':[('consolidated_budget_rule_id','!=',False)]}"/>
                                    <button type="object" name="action_open_budget_entries" string="Entries..."
                                            icon="fa-arrow-circle-o-right" attrs="{'invisible':[('consolidated_budget_rule_id','=',False)]}"/>
                                </tree>
                                <form string="Budget Lines">
                                    <group>
                                        <group>
                                            <field name="currency_id" invisible="1"/>
                                            <field name="consolidated_budget_id"/>
                                             <field name="description"  />
                                            <field name="planned_amount"/>
                                            <field name="adjustment"  />
                                            <field name="consolidated_budget_rule_id"   />
                                        </group>
                                        <group>
                                            <label for="date_from" string="Period"/>
                                            <div>
                                                <field name="date_from" class="oe_inline"/>
                                                -
                                                <field name="date_to" class="oe_inline"/>
                                            </div>
                                            <field name="company_id" options="{'no_create': True}"
                                                   groups="base.group_multi_company"/>
                                        </group>
                                    </group>
                                </form>
                            </field>
                        </page>
                        
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>
  
    <record model="ir.ui.view" id="consolidated_budget_view_tree">
        <field name="name">consolidated.budget.view.tree</field>
        <field name="model">consolidated.budget</field>
        <field name="arch" type="xml">
            <tree decoration-info="state == 'draft'" decoration-muted="state in ('done','cancel')" string="Budget">
                <field name="name" colspan="1"/>
                <field name="date_from"/>
                <field name="date_to"/>
                <field name="company_id" options="{'no_create': True}" groups="base.group_multi_company"/>
                <field name="user_id"/>
                <field name="state"/>
                <field name="activity_exception_decoration" widget="activity_exception"/>
            </tree>
        </field>
    </record>

   

    <record id="view_consolidated_budget_search" model="ir.ui.view">
        <field name="name">consolidated.budget.search</field>
        <field name="model">consolidated.budget</field>
        <field name="arch" type="xml">
            <search string="Budget">
                <field name="name" filter_domain="[('name', 'ilike', self)]" string="Budget"/>
                <field name="date_from"/>
                <field name="date_to"/>
                <filter string="Draft" name="draft" domain="[('state', '=', 'draft')]" help="Draft Budgets"/>
                <filter string="To Approve" name="toapprove" domain="[('state', '=', 'confirm')]"
                        help="To Approve Budgets"/>
                <separator/>
                <filter invisible="1" string="Late Activities" name="activities_overdue"
                    domain="[('activity_ids.date_deadline', '&lt;', context_today().strftime('%Y-%m-%d'))]"
                    help="Show all records which has next action date is before today"/>
                <filter invisible="1" string="Today Activities" name="activities_today"
                    domain="[('activity_ids.date_deadline', '=', context_today().strftime('%Y-%m-%d'))]"/>
                <filter invisible="1" string="Future Activities" name="activities_upcoming_all"
                    domain="[('activity_ids.date_deadline', '&gt;', context_today().strftime('%Y-%m-%d'))]"/>
            </search>
        </field>
    </record>

    <record model="ir.actions.act_window" id="act_consolidated_budget_view">
        <field name="name">Budgets</field>
        <field name="res_model">consolidated.budget</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="consolidated_budget_view_tree"/>
         <field name="search_view_id" ref="view_consolidated_budget_search"/>
         <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Click to create a new budget.
            </p>
            <p>
                Use budgets to compare actual with expected revenues and costs
            </p>
        </field>
    </record>
    

	 <record model="ir.actions.act_window" id="action_sale_order_line">
        <field name="name">Sale Order Line</field>
        <field name="res_model">sale.order.line</field>
        <field name="view_mode">tree,form</field>
    </record>
	
    <record id="view_consolidated_budget_line_search" model="ir.ui.view">
        <field name="name">account.budget.line.search</field>
        <field name="model">consolidated.budget.lines</field>
        <field name="arch" type="xml">
            <search string="Budget Lines">
                <field name="consolidated_budget_lines_container_id"/>
                <field name="consolidated_budget_id"/>
                <field name="consolidated_budget_rule_id"/>
                <filter name="filter_not_cancelled" string="Not Cancelled" domain="[('consolidated_budget_state','!=','cancel')]"/>
                <group expand="0" string="Group By">
                    <filter name="group_consolidated_budget_id" string="Budgets" domain="[]" context="{'group_by':'consolidated_budget_id'}"/>
                </group>
            </search>

        </field>
    </record>

    <record model="ir.ui.view" id="view_consolidated_budget_line_tree">
        <field name="name">consolidated.budget.line.tree</field>
        <field name="model">consolidated.budget.lines</field>
        <field name="arch" type="xml">
            <tree string="Budget Lines" create="0">
                <field name="currency_id" invisible="1"/>
                <field name="consolidated_budget_id" invisible="1"/>
                <field name="consolidated_budget_rule_id" />
                <field name="consolidated_budget_lines_container_id"  />
                <field name="company_id" groups="base.group_multi_company"/>
                <field name="date_from"  />
                <field name="date_to"  />
                <field name="planned_amount"/>
                <field name="practical_amount"/>
            </tree>
        </field>
    </record>
    <record model="ir.ui.view" id="view_consolidated_budget_line_form">
        <field name="name">consolidated.budget.line.form</field>
        <field name="model">consolidated.budget.lines</field>
        <field name="arch" type="xml">
            <form string="Budget Lines">
                <sheet>
                    <group col="4">
                        <field name="currency_id" invisible="1"/>
                        <field name="consolidated_budget_state" invisible="1"/>
                        <field name="consolidated_budget_id"  attrs="{'readonly':[('consolidated_budget_state','!=','draft')]}"/>
                        <field name="consolidated_budget_lines_container_id"  attrs="{'readonly':[('consolidated_budget_state','!=','draft')]}"/>
                        <field name="consolidated_budget_rule_id"  attrs="{'readonly':[('consolidated_budget_state','!=','draft')]}"/>
                        <field name="date_from"  attrs="{'readonly':[('consolidated_budget_state','!=','draft')]}"/>
                        <field name="date_to"  attrs="{'readonly':[('consolidated_budget_state','!=','draft')]}"/>
                        <field name="planned_amount" attrs="{'readonly':[('consolidated_budget_state','!=','draft')]}"/>
                        <field name="practical_amount" attrs="{'readonly':[('consolidated_budget_state','!=','draft')]}"/>
                        <field name="company_id" options="{'no_create': True}" groups="base.group_multi_company"  attrs="{'readonly':[('consolidated_budget_state','!=','draft')]}"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="view_consolidated_budget_line_pivot">
        <field name="name">consolidated.budget.line.pivot</field>
        <field name="model">consolidated.budget.lines</field>
        <field name="arch" type="xml">
            <pivot string="Budget Lines">
                <field name="consolidated_budget_id" type="row"/>
                <field name="planned_amount"  type="measure" string="Planned amount"/>
                <field name="practical_amount" type="measure" string="Practical amount"/>
            </pivot>
        </field>
    </record>

    <record model="ir.ui.view" id="view_consolidated_budget_line_graph">
        <field name="name">consolidated.budget.line.graph</field>
        <field name="model">consolidated.budget.lines</field>
        <field name="arch" type="xml">
            <graph string="Budget Lines">
                <field name="consolidated_budget_id" type="row"/>
                <field name="planned_amount"  type="measure" string="Planned amount"/>
                <field name="practical_amount" type="measure" string="Practical amount"/>
            </graph>
        </field>
    </record>
    <record model="ir.actions.act_window" id="act_consolidated_budget_lines_view">
        <field name="name">Budgets Analysis</field>
        <field name="res_model">consolidated.budget.lines</field>
        <field name="view_mode">tree,form,pivot,graph</field>
        <field name="view_id" eval="False"/>
        <field name="context">{'search_default_group_consolidated_budgdet_id': True, 'search_default_filter_not_cancelled':True}</field>
    </record>
    
 <menuitem
        id="consolidated_budget_menu_root"
        parent="syd_consolidated_base.consolidated_menu_root"
        name="Budget Consolidated"
        sequence="101"/>
        
      <menuitem
      	id="consolidated_budget_menu_operation"
        parent="syd_consolidated_base.consolidated_menu_root"
        name="Operation"
        sequence="101"/>   

        
  
       
        
      <menuitem action="open_budget_container_form" id="menu_budget_container_form"
              parent="consolidated_budget_menu_operation" sequence="20"/>
              
        <menuitem action="open_budget_container_model_form" id="menu_budget_container_model_form"
              parent="consolidated_budget_menu_operation" sequence="18"/>
              
                
   <menuitem action="open_budget_rule_form" id="menu_budget_rule_form"
              parent="consolidated_budget_menu_operation" sequence="11"/>
              
    <menuitem parent="consolidated_budget_menu_operation" 
              id="menu_act_consolidated_budget_lines_view"
              action="act_consolidated_budget_lines_view" sequence="40"
              
              
              />

    <menuitem parent="consolidated_budget_menu_root"
              id="menu_act_consolidated_budget_view"
              name="Budgets"
              action="act_consolidated_budget_view" sequence="2"
              groups="account.group_account_manager"/>

</odoo> 
